version: '3.8'

# Entropy Infrastructure: Professional Secure Messaging Relay
services:
  entropy-relay:
    build: .
    container_name: entropy-relay
    restart: always
    ports:
      - "8080:8080"
    environment:
      - ENTROPY_PORT=8080
      - ENTROPY_ADDR=0.0.0.0
      - ENTROPY_REDIS_URL=redis://redis:6379
      - ENTROPY_SECRET_SALT=${ENTROPY_SECRET_SALT:-CHANGE_ME}
      - ENTROPY_ALLOWED_ORIGINS=${ENTROPY_ALLOWED_ORIGINS:-*}
    depends_on:
      - redis

  redis:
    image: redis:7-alpine
    container_name: entropy-redis
    restart: always
    command: ["redis-server", "--save", "", "--appendonly", "no", "--maxmemory", "256mb", "--maxmemory-policy", "allkeys-lru"]
    expose:
      - "6379"
